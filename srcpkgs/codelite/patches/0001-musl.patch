From 62f450b79993ea12e81007158471aadaf2d7f67d Mon Sep 17 00:00:00 2001
From: Nathan Owens <ndowens@artixlinux.org>
Date: Sat, 14 Nov 2020 19:37:11 -0600
Subject: [PATCH] musl

---
 codelitegcc/main.cpp                 | 1 +
 sdk/codelite_indexer/libctags/read.c | 5 +++++
 2 files changed, 6 insertions(+)

diff --git codelitegcc/main.cpp codelitegcc/main.cpp
index 1b78e08..a4ffdc3 100644
--- codelitegcc/main.cpp
+++ codelitegcc/main.cpp
@@ -33,6 +33,7 @@ extern int ExecuteProcessWIN(const std::string& commandline);
 #include <sys/file.h>
 #include <sys/stat.h>
 #include <sys/stat.h>
+#include <fcntl.h>
 
 void WriteContent( const std::string& logfile, const std::string& filename, const std::string& flags )
 {
diff --git sdk/codelite_indexer/libctags/read.c sdk/codelite_indexer/libctags/read.c
index 7dffde6..d6cc961 100644
--- sdk/codelite_indexer/libctags/read.c
+++ sdk/codelite_indexer/libctags/read.c
@@ -605,6 +605,9 @@ extern int readChars (char *buffer, size_t bufferSize, fpos_t location, fpos_t e
 #if defined(__WXMSW__) || defined(__APPLE__) || defined(__FreeBSD__)
 	if(location < 0)
 		return 0;
+#elif defined(__linux__) && !defined(__GLIBC__) /* musl */
+	if(location.__lldata < 0)
+		return 0;
 #elif defined(__NetBSD__)
 	if(location._pos < 0)
 		return 0;
@@ -625,6 +628,8 @@ extern int readChars (char *buffer, size_t bufferSize, fpos_t location, fpos_t e
 
 #if defined(__WXMSW__) || defined(__APPLE__) || defined(__FreeBSD__)
 	sizeToRead = endPos - location;
+#elif defined(__linux__) && !defined(__GLIBC__) /* musl */
+	sizeToRead = endPos.__lldata - location.__lldata;
 #elif defined(__NetBSD__)
 	sizeToRead = endPos._pos - location._pos;
 #else
-- 
2.29.2

diff --git sdk/codelite_indexer/network/named_pipe.cpp sdk/codelite_indexer/network/named_pipe.cpp
index 6e72994..4acc6bb 100644
--- sdk/codelite_indexer/network/named_pipe.cpp
+++ sdk/codelite_indexer/network/named_pipe.cpp
@@ -27,7 +27,7 @@
 
 #ifndef __WXMSW__
 #  include <sys/types.h>
-#  include <sys/unistd.h>
+#  include <unistd.h>
 #  include <sys/socket.h>
 #  include <sys/time.h>
 #endif
diff --git sdk/codelite_indexer/network/named_pipe_server.cpp sdk/codelite_indexer/network/named_pipe_server.cpp
index 708df48..6171cf3 100644
--- sdk/codelite_indexer/network/named_pipe_server.cpp
+++ sdk/codelite_indexer/network/named_pipe_server.cpp
@@ -26,7 +26,7 @@
 #include "named_pipe_server.h"
 #ifndef __WXMSW__
 # include <sys/types.h>
-# include <sys/unistd.h>
+# include <unistd.h>
 # include <sys/socket.h>
 #endif
 clNamedPipeServer::clNamedPipeServer(const char* pipePath)
